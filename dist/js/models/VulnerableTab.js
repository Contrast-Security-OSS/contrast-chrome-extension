import{deDupeArray,murmur,isEmptyObject}from"../util.js";function VulnerableTabError(a,t,e){throw new Error(a,t,e)}function VulnerableTab(a,t,e=[]){this.traceIDs=e,this.path=a.split("?")[0],this.vulnTabId=murmur(this.path+"|"+t),this.appNameHash=murmur(t)}VulnerableTab.prototype.setTraceIDs=function(a){this.traceIDs=deDupeArray(this.traceIDs.concat(a))},VulnerableTab.prototype.storeTab=function(){return new Promise(async(a,t)=>{let e=await this.getApplicationTabs();e[this.appNameHash][this.vulnTabId]=this.traceIDs,chrome.storage.local.set(e,()=>{chrome.storage.local.get(this.appNameHash,e=>{e&&e[this.appNameHash]?a(e[this.appNameHash]):t(new VulnerableTabError("Error Storing Tab",this.vulnTabId,this.path))})})})},VulnerableTab.prototype.getApplicationTabs=function(){return new Promise(a=>{chrome.storage.local.get(this.appNameHash,t=>{t&&!isEmptyObject(t)||(t[this.appNameHash]={}),a(t)})})},VulnerableTab.prototype.getStoredTab=function(){return new Promise(a=>{chrome.storage.local.get(this.appNameHash,t=>{t&&t[this.appNameHash]?a(t[this.appNameHash]):a(null)})})},VulnerableTab.buildTabPath=function(a){const t=new URL(a);let e=t.pathname;return t.hash&&(e+=t.hash),e};export default VulnerableTab;