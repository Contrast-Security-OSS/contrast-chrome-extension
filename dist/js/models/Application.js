import{STORED_APPS_KEY,CONTRAST_GREEN,getHostFromUrl,isBlacklisted,updateTabBadge,updateExtensionIcon}from"../util.js";export default function Application(r,e){this[r]=e.app_id,this.id=e.app_id,this.name=e.name,this.domain=r,this.host=r}Application.retrieveApplicationFromStorage=function(r){return new Promise((e,t)=>{chrome.storage.local.get(STORED_APPS_KEY,o=>{chrome.runtime.lastError&&t(new Error("Error retrieving stored applications")),o&&o[STORED_APPS_KEY]||(o={[STORED_APPS_KEY]:[]});const i=new URL(r.url),n=getHostFromUrl(i),a=o[STORED_APPS_KEY].filter(r=>r.host===n)[0];if(a)e(a);else{if(isBlacklisted(r.url)||chrome.runtime.lastError){if(isBlacklisted(r.url)&&!chrome.runtime.lastError)try{updateExtensionIcon(r,1),updateTabBadge(r,"",CONTRAST_GREEN)}catch(r){t(new Error("Error updating tab badge"))}}else try{updateExtensionIcon(r,1),updateTabBadge(r,"")}catch(r){t(new Error("Error updating tab badge"))}e(null)}})})},Application.getStoredApp=function(r,e){if(!e)throw new Error("application must be defined");return(r[STORED_APPS_KEY]||r).filter(r=>r.id===e.app_id)[0]},Application.subDomainColonForUnderscore=function(r){return"object"==typeof r?this._subColonOrUnderscore(r.domain):this._subColonOrUnderscore(r)},Application._subColonOrUnderscore=function(r){return r.includes("_")?r.replace("_",":"):r.includes(":")?r.replace(":","_"):r};