import{getStorageVulnsAndRender,hideLoadingIcon}from"./popupMethods.js";import{STORED_APPS_KEY,getStoredCredentials,isCredentialed,getHostFromUrl,isEmptyObject,setElementDisplay}from"./util.js";function renderLoadingIcon(){document.getElementById("vulns-loading").style.display="block"}document.addEventListener("DOMContentLoaded",()=>{chrome.storage.local.get(STORED_APPS_KEY,e=>{chrome.tabs.query({active:!0,currentWindow:!0},t=>{if(!t[0])return;const n=t[0],o=new URL(n.url),r=getHostFromUrl(o),d=e[STORED_APPS_KEY],i=d?d.filter(e=>e[r])[0]:d;if(i&&!isEmptyObject(i))getStoredCredentials().then(e=>{if(!isCredentialed(e))throw new Error("Not Credentialed");renderLoadingIcon(),getStorageVulnsAndRender(e,i,n)}).catch(e=>new Error(e));else{const e=document.getElementById("vulnerabilities-found-on-page");setElementDisplay(e,"none"),hideLoadingIcon()}})})},!1);